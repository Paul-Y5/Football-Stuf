<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rankings - Football Java</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <nav class="navbar">
        <a href="/" class="navbar-brand">
            Football<span>Java</span>
        </a>
        <ul class="nav-links">
            <li><a href="/rankings" class="active">Rankings</a></li>
            <li><a href="/draw">Draw Simulator</a></li>
        </ul>
    </nav>

    <main class="container">
        <header class="page-header">
            <h1 class="page-title">Club Rankings</h1>
            <p class="page-subtitle">Worldwide football club rankings</p>
        </header>

        <div class="stats-grid" th:if="${globalStats != null}">
            <div class="stat-card">
                <div class="stat-value" th:text="${globalStats['totalClubs'] ?: 0}">0</div>
                <div class="stat-label">Clubs</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" th:text="${globalStats['totalCountries'] ?: 0}">0</div>
                <div class="stat-label">Countries</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" th:text="${#numbers.formatDecimal(globalStats['avgPoints'] ?: 0, 0, 0)}">0</div>
                <div class="stat-label">Avg Points</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" th:text="${globalStats['maxPoints'] ?: 0}">0</div>
                <div class="stat-label">Max Points</div>
            </div>
        </div>

        <form class="search-bar" th:action="@{/rankings}" method="get">
            <input type="text" class="form-control" name="search" placeholder="Search clubs..."
                th:value="${searchQuery}">
            <select class="form-control country-select" name="country" aria-label="Filter by country">
                <option value="">All Countries</option>
                <option th:each="c : ${countries}" th:value="${c}" th:text="${c}" th:selected="${c == selectedCountry}">
                    Country</option>
            </select>
            <button type="submit" class="btn btn-primary">Filter</button>
            <a href="/rankings" class="btn btn-secondary">Reset</a>
        </form>

        <div th:unless="${apiConfigured}" class="alert alert-warning">
            API key not configured. Set FOOTBALL_API_KEY for live updates.
        </div>

        <div th:if="${apiConfigured}" class="api-refresh-section">
            <form th:action="@{/rankings/refresh}" method="post" class="api-refresh-form">
                <select name="competition" class="form-control form-control-auto" aria-label="Select competition">
                    <option value="PL">Premier League</option>
                    <option value="PD">La Liga</option>
                    <option value="SA">Serie A</option>
                    <option value="BL1">Bundesliga</option>
                    <option value="FL1">Ligue 1</option>
                    <option value="CL">Champions League</option>
                </select>
                <button type="submit" class="btn btn-primary">Update from API</button>
            </form>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Club Rankings</h2>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Club</th>
                            <th>Country</th>
                            <th>Points</th>
                            <th>Change</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="club : ${clubs}">
                            <td th:text="${club.ranking}">1</td>
                            <td>
                                <div class="club-row">
                                    <img th:if="${club.crestUrl}" th:src="${club.crestUrl}" alt="" class="club-crest"
                                        onerror="this.style.display='none'">
                                    <span class="club-name" th:text="${club.name}">Club Name</span>
                                </div>
                            </td>
                            <td th:text="${club.country}">Country</td>
                            <td th:text="${club.points}">1000</td>
                            <td>
                                <span
                                    th:class="${club.pointsChange > 0 ? 'trend-up' : (club.pointsChange < 0 ? 'trend-down' : 'trend-stable')}"
                                    th:text="${club.pointsChange > 0 ? '+' + club.pointsChange : club.pointsChange}">0</span>
                            </td>
                            <td>
                                <span th:if="${club.trend.name() == 'UP'}" class="badge badge-success">Up</span>
                                <span th:if="${club.trend.name() == 'DOWN'}" class="badge badge-danger">Down</span>
                                <span th:if="${club.trend.name() == 'STABLE'}" class="badge badge-neutral">Stable</span>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(clubs)}">
                            <td colspan="6">
                                <div class="empty-state">
                                    <p>No clubs found. Load data via API or CSV.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer class="footer">
        Football Java | Spring Boot
    </footer>
</body>

</html>